# App 自动化播放 + Frida 监听 + m3u8 下载方案

> 适用于 **自有产品测试 / 自动化实验**
>
> 核心目标：
> **自动触发 App 播放 → 监听响应 → 提取 m3u8 → 自动下载**

---

## 一、总体目标

构建一套**全自动流水线**，完成以下闭环：

1. 自动操作 App，触发视频播放  
2. 在播放过程中监听网络请求与响应  
3. 捕获接口返回的完整 JSON 数据  
4. 从响应中解析出 m3u8 播放地址  
5. 自动下载视频内容（无需人工介入）

---

## 二、整体架构

系统拆分为 **4 个独立模块**，职责清晰、互不侵入：

```
┌──────────┐
│ Appium   │  ← 自动触发播放
└────┬─────┘
     │
     ▼
┌──────────┐
│   App    │
└────┬─────┘
     │ 网络请求
     ▼
┌──────────┐
│  Frida   │  ← 监听请求/响应
└────┬─────┘
     │ send(JSON)
     ▼
┌──────────┐
│  Python  │  ← 解析 & 调度
└────┬─────┘
     │ m3u8
     ▼
┌──────────┐
│ 下载器   │
└──────────┘
```

---

## 三、模块职责说明

### 1️⃣ App 操作层（Appium）

**职责：**

- 启动 App
- 自动点击书籍 / 章节
- 触发视频播放行为

**说明：**

- 只负责 UI 行为
- 不处理网络、不处理下载
- 不与 Frida 直接通信

---

### 2️⃣ 网络监听层（Frida）

**职责：**

- 注入目标 App 进程
- 监听网络层接口返回
- 捕获 Response 中的完整 JSON 数据
- 将 JSON 数据原样发送给外部控制端

**说明：**

- Hook 网络层（OkHttp / Retrofit）
- 不修改请求、不破坏签名
- 不解析业务字段，只负责“监听与转发”

---

### 3️⃣ 数据解析与调度层（Python）

**职责：**

- 启动并管理 Frida 会话
- 接收 Frida 发送的 JSON 数据
- 解析响应结构
- 提取视频播放相关字段（如 m3u8 地址）
- 做去重、过滤、调度

**说明：**

- 所有业务判断集中在此层
- 决定下载哪些视频
- 决定清晰度、CDN 优先级

---

### 4️⃣ 视频下载层（m3u8 下载器）

**职责：**

- 接收 m3u8 地址
- 下载 ts 分片
- 合并并生成视频文件

**说明：**

- 独立进程或模块
- 不感知 App / Frida / Appium
- 可自由替换实现

---

## 四、数据流说明

### UI 行为流

```
Appium → App
```

### 网络数据流

```
App → Frida → Python
```

### 下载任务流

```
Python → m3u8 下载器
```

---

## 五、关键设计原则

- **分层解耦**：每一层只做一件事
- **不侵入业务**：不修改 App 原始逻辑
- **网络层监听**：稳定、通用、可扩展
- **自动化闭环**：无需人工干预

---

## 六、适用场景

- 自有 App 自动化测试
- 播放链路回归验证
- CDN / 清晰度策略验证
- 自动化内容采集实验

---

## 七、注意事项

- 仅用于合法、自有产品测试
- 请遵守当地法律法规
- 不用于第三方 App 或未授权场景
